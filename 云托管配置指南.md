# å¾®ä¿¡äº‘æ‰˜ç®¡é…ç½®æŒ‡å—

## ğŸ“‹ åŸºäºå®˜æ–¹æ–‡æ¡£çš„æœ€ä½³å®è·µ

æ ¹æ®å¾®ä¿¡å®˜æ–¹å¼€å‘æ–‡æ¡£ï¼Œæ¨èä½¿ç”¨**å¾®ä¿¡äº‘æ‰˜ç®¡**æ¥å®ç°å…¬ä¼—å·æœåŠ¡å™¨åŠŸèƒ½ã€‚

## ğŸš€ æ­¥éª¤ä¸€ï¼šå¼€é€šå¾®ä¿¡äº‘æ‰˜ç®¡

### 1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­
- ç‚¹å‡»èœå•æ "äº‘å¼€å‘"
- é€‰æ‹©"äº‘æ‰˜ç®¡" 
- ç‚¹å‡»"å¼€é€š"
- é€‰æ‹©"æŒ‰é‡è®¡è´¹"ï¼ˆå…è´¹é¢åº¦å……è¶³ï¼‰

### 2. åˆ›å»ºæœåŠ¡
- æœåŠ¡åç§°ï¼š`wechat-server`
- åœ°åŸŸï¼šé€‰æ‹©è·ç¦»æœ€è¿‘çš„
- ç½‘ç»œï¼šé»˜è®¤

## ğŸ”§ æ­¥éª¤äºŒï¼šéƒ¨ç½²ä»£ç 

### 1. åˆ›å»ºäº‘æ‰˜ç®¡é¡¹ç›®ç»“æ„
```
cloudbaserc.json          # äº‘æ‰˜ç®¡é…ç½®
server/
  â”œâ”€â”€ index.js            # æœåŠ¡å™¨ä¸»æ–‡ä»¶
  â”œâ”€â”€ package.json        # ä¾èµ–é…ç½®  
  â””â”€â”€ Dockerfile          # å®¹å™¨é…ç½®
```

### 2. æ ¸å¿ƒä»£ç å®ç°

**server/index.js:**
```javascript
const express = require('express')
const crypto = require('crypto')
const app = express()

// å¾®ä¿¡éªŒè¯
app.get('/wechat', (req, res) => {
  const token = 'babyGrowthRecord2024'
  const { signature, timestamp, nonce, echostr } = req.query
  
  const arr = [token, timestamp, nonce].sort()
  const str = arr.join('')
  const sha1 = crypto.createHash('sha1').update(str).digest('hex')
  
  if (signature === sha1) {
    res.send(echostr)
  } else {
    res.send('éªŒè¯å¤±è´¥')
  }
})

// æ¥æ”¶å¾®ä¿¡æ¶ˆæ¯
app.post('/wechat', (req, res) => {
  // å¤„ç†å›¾ç‰‡æ¶ˆæ¯å’Œæ–‡æœ¬æ¶ˆæ¯
  // è°ƒç”¨å°ç¨‹åºäº‘å‡½æ•°
  // è¿”å›å›å¤æ¶ˆæ¯
})

app.listen(80)
```

**server/package.json:**
```json
{
  "name": "wechat-server",
  "version": "1.0.0",
  "dependencies": {
    "express": "^4.18.0"
  }
}
```

**cloudbaserc.json:**
```json
{
  "envId": "ä½ çš„ç¯å¢ƒID",
  "framework": {
    "name": "wechat-server",
    "plugins": {
      "node": {
        "use": "@cloudbase/framework-plugin-node",
        "inputs": {
          "entry": "server/index.js",
          "name": "wechat-server"
        }
      }
    }
  }
}
```

## ğŸŒ æ­¥éª¤ä¸‰ï¼šè·å–è®¿é—®åœ°å€

éƒ¨ç½²æˆåŠŸåï¼Œäº‘æ‰˜ç®¡ä¼šæä¾›ï¼š
- **è®¿é—®åœ°å€**ï¼š`https://wechat-server-xxx.ap-shanghai.app.tcloudbase.com`
- è¿™ä¸ªåœ°å€ç”¨äºé…ç½®å…¬ä¼—å·æœåŠ¡å™¨URL

## ğŸ“± æ­¥éª¤å››ï¼šé…ç½®å…¬ä¼—å·

1. **ç™»å½•å¾®ä¿¡å…¬ä¼—å¹³å°**
2. **å¼€å‘ â†’ åŸºæœ¬é…ç½®**
3. **æœåŠ¡å™¨é…ç½®**ï¼š
   - URLï¼š`https://wechat-server-xxx.ap-shanghai.app.tcloudbase.com/wechat`
   - Tokenï¼š`babyGrowthRecord2024`
   - æ¶ˆæ¯åŠ è§£å¯†ï¼šæ˜æ–‡æ¨¡å¼

## âœ… ä¼˜åŠ¿

- **å®˜æ–¹æ”¯æŒ**ï¼šå¾®ä¿¡å®˜æ–¹æä¾›çš„äº‘æ‰˜ç®¡æœåŠ¡
- **è‡ªåŠ¨HTTPS**ï¼šè‡ªåŠ¨æä¾›SSLè¯ä¹¦
- **é«˜å¯ç”¨æ€§**ï¼šè‡ªåŠ¨æ‰©å®¹å’Œå®¹é”™
- **æˆæœ¬ä½å»‰**ï¼šå…è´¹é¢åº¦å……è¶³ä¸ªäººä½¿ç”¨
- **é›†æˆåº¦é«˜**ï¼šä¸å°ç¨‹åºäº‘å¼€å‘æ— ç¼é›†æˆ

## ğŸ”— å‚è€ƒæ–‡æ¡£

- [å¾®ä¿¡äº‘æ‰˜ç®¡å®˜æ–¹æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/wxcloudrun/)
- [å…¬ä¼—å·å¼€å‘æ–‡æ¡£](https://developers.weixin.qq.com/doc/offiaccount/Basic_Information/Access_Overview.html) 